<section class="story-filters">

  {% include search.html %}

  {% assign tags = "" | split:"" %}
  {% for p in site.posts %}
    {% for t in p.tags %}
      {% unless tags contains t %}
        {% assign tags = tags | push:t %}
      {% endunless %}
    {% endfor %}
  {% endfor %}
  {% assign tags = tags | sort %}
  <div class="filters-href" id="filters-href">
    <h3>Filter<span class="filters-href-button"><i class="fa fa-chevron-down"></i></span></h3>
    <div class="filters-href-list">
      <ul>
        <li class="filters-list-item"><a href="/stories/#Newest">Newest</a><span class="filters-item-count">{{ site.posts | size }}</span></li>
        {% for t in tags %}
        <li class="filters-list-item"><a href="/stories/#{{ t | replace: ' ', '%20'}}">{{ t }}</a><span class="filters-item-count">{{ site.tags.[t] | size }}</span></li>
	      {% endfor %}
      </ul>
      <span class="filters-href-button"><i class="fa fa-chevron-down"></i></span>
    </div>
  </div>
  <script>
    $('.filters-href-button').on('click', function(){
      var height = 10, elem = $('#filters-href');
      if(!elem.hasClass('filters-href_open')){
        height += 10 + elem.children('.filters-href-list').children('ul').height();
      }
      elem.toggleClass('filters-href_open').children('.filters-href-list').css('height', height);
    });
  </script>
  <div class="dropdown">
    <h3>Filter</h3>
    <select onchange="window.location.href=this.options[this.selectedIndex].value">
      <option value="/stories/#Newest">Newest ({{ site.posts | size }})</option>
      {% for t in tags %}
        <option value="/stories/#{{ t | replace: ' ', '%20'}}">{{ t }} ({{ site.tags.[t] | size }})</option>
      {% endfor %}
    </select>
  </div>
  <script src="/javascripts/stories-filtering.js">
  </script>
</section>
